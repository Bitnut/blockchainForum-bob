2019/6/7 创建文档
2019/6/8 关闭第一次文档编辑
这个文档展示梧桐林的开发进度、现有漏洞/bug 和未来的开发计划


# 论坛开发第一大阶段——毕设开发

论坛的设想是在完成本科毕设的过程中完善的，在期间做了许多的技术学习和实验等。需求变更较为频繁，这里做一些小回顾。

#### 论坛需求设计（v0.1）

论坛开发采用敏捷开发模式Scrum。在Scrum软件开发过程中，在需求分析过程产出了一份 Product Backlog 文档。说实话这份文档仅仅考虑的是毕设开发过程中的一些工作，非常粗浅，并不适合指导日后的开发过程。但是如果拿来作为小结，它也是足够的。

ID|名字|重要性(Imp)|具体实现|注解|Sprint
-|-|-|-|-|-
1|创建网站主页面|50|登录可以查看热门文章、访问推荐用户的主页、浏览最新发布的文章|新上手Antd，未完成的需求可以延后|1
2|创建网站注册登录模块|45|游客可以注册、用户可以登录|新上手Antd，未完成的需求可以延后|1
3|创建网站个人主页面|45|个人主页可以展示详细的个人信息和已发布的文章等|新上手Antd，未完成的需求可以延后|1
4|创建奖励池页面|45|奖励池包括公示所有用户提供的资金以及公示本月最热文章|新上手Antd，未完成的需求可以延后|1
5|网站数据库表设计|40|设计包括用户表、文章表、评论表在内的最基础的三张表格|　|1
6|个人密码加密|40|用户密码必须确保不使用明文存储|　|1
7|创建网站文章编辑页面|35|用户可以在这个页面新建、编辑、保存和发布文章|新上手Antd，未完成的需求可以延后|2
8|搭建后端服务器|35|后端服务器监听8889端口，采用Koa实现|设计路由表分离代码实现|2
9|后端api接口实现|35|登录注册以及其他网站功能的服务接口|采用MVC模式编写代码逻辑，用ORM操作MySQL|2
10|区块链网络搭建|35|区块链网络包括一个orderer节点、两个分别包含两个peer节点的组织和两个ca节点|使用docker-compose进行网络配置服务|2
11|智能合约编写|30|管理员可以调用chaincode 新建和保存文章|智能合约用go语言编写和实现|2
12|区块链反向代理|30|能够实现管理员注册、创建通道、调用chaincode等功能|使用Express框架编写，良好的调试信息|2
13|使用Redux状态管理容器|25|网页state树跟踪，状态管理和调试|引入redux-logger辅助进行开发|3
14|token身份验证实现|25|采用JWT令牌的形式管理用户身份验证功能|考虑到系统架构问题级别的升级|3
|15|浏览文章页面|20|用户可以在这个页面上浏览文章内容、文章信息| |　3
16|网站写作模块完善|20|更完善的编辑页面|　|3
17|个人主页完善|20|更完善的主页|　|3
18|第一次代码重构|20代码重构、bug集中调试|这不包括之前产生的全部代码| |3
19|网站全局路由守护|15|安全升级|　|4
20|评论功能|15|文章页面的功能之一|　|4
21|404页面|15|安全升级||4
22|头像上传|10|个人设置页面的功能之一|　|4
23|网站静态资源服务|10|网站性能提升|　|4
24|文章编辑器功能改进|10|更好的编辑器|　|4
25|优化网站首屏加载|10|网站性能提升|　|4
26|网站主页优化|10|更好的首页|　|4
27|建设网站点赞、收藏、打赏+奖励池体系|10|完整的文章打赏体系|到这里论坛的经济体系才开始完善|5
28|实现与区块链链接与交互|10|实现文章上链| |5
29|论坛页面优化|10|论坛的所有页面css调整和美化|　|5
...|...|...|...|...|...


#### 论坛业务需求设计（v0.1）

这里罗列一些简单的业务流程总结，具体内容和开发出来的会有出入是因为中途出现了需求变更。这里给出的是最早编写的需求分析，目前没有更新文档。

-----------------------------
#### 词汇表

首先是词汇表，这里描述了接下来需要用到的转悠名词等。
* 游客： 指没有注册过的用户
* 用户/论坛用户： 指已经注册过的用户，两者含义相同
* 个人用户面板： 指一组用户个人界面等页面的链接
* 后台/论坛后台： 指论坛的后端服务器，不包含数据库部分
* 表单： 数据组合的提交方式
* 文章编辑器： 用户用于编辑、发布文章工作的位置


----------------------------------
#### 论坛用例（详细用例）

1 论坛注册

范围： 知识分享论坛

级别： 用户目标

主要参与者： 游客

协助参与者：（短信？微信qq？）备选实现

涉众及其关注点：
- 游客： 希望可以快速注册，注册的个人信息保证隐私，没有注册中服务器的错误。希望注册后能够直接开始网站体验。
- 论坛用户状态栏服务： 在用户注册后显示个人用户面板和退出登录按钮。
- 论坛后台： 对用户的注册信息保证唯一性，希望快速处理用户的注册信息，快速生成日后需要的一些信息。生成用户的个人档案。

后置条件： 服务器存储用户个人信息，个人密码以加密形式保存。后台生成登录的当地时间，和其他必要的个人信息。

主成功场景：
1. 游客点击注册按钮进入注册界面。
2. 游客输入用户名、密码、确认密码、个人邮箱、个人手机号码，填写个人介绍（可选）后，点击确认，提交注册表单。
3. 系统对用户名、个人邮箱和手机号码进行查重，没有重复项即生成默认的个人信息：用户Id、头像、性别、注册时间、常用编辑器、邮箱提醒、个人介绍、奖赏设置和奖赏数目。
4. 网页提示注册成功，并跳转至论坛主页。页头显示登录后信息：个人页面链接和退出登录按钮。游客正式成为论坛用户。

扩展：

2a. 用户输入确认密码不一致

1. 表单内进行判断并返回错误信息。

2a. 用户输入已被注册过的用户名或个人邮箱或手机号码

1. 用户提交表单。
2. 论坛后台进行校验后返回错误信息。
3. 前段接收错误信息，不进行跳转。



2 论坛登录/登出

范围： 知识分享论坛

级别： 用户目标

主要参与者： 论坛用户

协助参与者：（短信？微信qq？）备选实现

涉众及其关注点：
- 用户： 希望可以快速登录，登录之后直接开始网站体验。关闭当前页面或关闭浏览器仍能够记录登录状态。退出登陆后网站清除个人登录信息。
- 论坛用户状态栏服务： 在用户登录后显示个人用户面板和退出登录按钮。
- 论坛前端页面： 对用户的登录请求在当前页面显示登录框，登录之后在浏览器端保存用户登录信息，重新打开页面时不再需要登录框登录。退出登录请求将清除浏览器端的个人登录信息。

前置条件： 用户必须已经注册成功。

主成功场景：
1. 用户点击登录按钮。
2. 论坛页面弹出登录框。
3. 用户填写登录用户名和密码提交登录表单。
4. 论坛后台验证通过后返回成功信息。
5. 论坛显示登录成功提示，在浏览器端记录用户登录信息。
6. 用户登录成功。
用户每次未退出登录便在关闭页面之后再次登录重复步骤6
7. 用户点击退出登录按钮。
8. 前端页面在浏览器端清除个人用户信息。
9. 前端页面提示退出登录。

扩展：

3a. 用户输入错误的用户名或密码

1. 后台返回错误信息。
2. 前端提示错误内容。

6a. 用户重新打开页面距离上次打开页面时间过长
1. 前端页面判断时间是否超过一周。
2. 前段页面清除个人登录信息，并显示未登录状态。



3 用户修改个人信息

范围： 知识分享论坛

级别： 用户目标

主要参与者： 论坛用户

涉众及其关注点：
- 用户： 希望可以提供方便简洁的界面对个人信息进行完善和更改。
- 论坛后台： 在用户修改跟人信息后及时更新个人信息。
- 论坛前端页面： 对用户的个人信息进行及时更新。

前置条件： 用户必须已经注册成功。

主成功场景：
1. 用户登录后，进入个人设置页面。
2. 用户修改个人信息后点击保存按钮。
3. 前端页面直接刷新，并把更新后的个人信息传给后台。
4. 后台接收到更新，对个人信息进行更新。



4 编写文章与文章发布

范围： 知识分享论坛

级别： 用户目标

主要参与者： 论坛用户

涉众及其关注点：
- 用户： 希望可以提供 markdown 和富文本支持编辑方式；编辑过程中可以保存；编辑完成后可以选择发布或者不发布。
- 论坛后台： 保存用户的新文章，为新文章添加默认的文章信息。依据用户选择给文章加上是否发布的标签。

前置条件： 用户必须已经登录。

主成功场景：
1. 用户在登录后的论坛界面点击写文章按钮。
2. 进入编辑页面。
3. 用户新增一篇空白文章，并进行编写。
4. 用户编辑完成后保存。
用户不发布文章则重复步骤4
5. 用户选择发布文章，系统存储用户编写的新文章。并添加文章的默认属性，文章状态保存为已发布。


扩展：

2a. 用户更改编辑器类型。

1. 前端重新加载对应类型的文章编辑器，后台修改并存储默认编辑器类型。

3a. 用户选择一篇已存在但未发布的文章进行编写

1. 用户选择文章，前端判断文章使用编辑器类型，在需要的时候加载新的编辑器并加载文章内容。
2. 用户编辑文章并保存。
3. 用户选择发布文章，或者继续保存但不发布。
用户若选择保存则重复以上步骤1-3
4. 系统更新用户编写的文章。文章状态保存为已发布。

-----------------------------------

#### 任务以及完成情况

项目初始阶段 2019/3/8

1.   网站主页 &#10003;

2.   网站登录模块 &#10003;

3.   个人密码加密 &#10003;

4.   网站个人主页面 &#10003;

5.   奖励池页面 &#10003; 

第二次开会 2019/3/26

6.   网站个人信息页面 &#10003;

7.   创建网站写作模块 &#10003;

8.   后端数据库表格设计 &#10003;

9.   后端api接口 &#10003;

第三次开会 2019/4/10

10.   加入redux状态管理容器 &#10003;

11.   后端token验证 &#10003;

12.   浏览文章页面 &#10003;

13.   网站写作模块完善 &#10003;

13.   个人主页完善 &#10003;

14.   代码重构 &#10003;

15.   后端api接口维护 &#10003;

第四次开会 2019/4/24

16.   网站全局路由守护 &#10003;

17.   评论功能上线 &#10003;

18.   404页面 &#10003;

19.   个人头像上传 &#10003;

20.   网站静态资源服务 &#10003;

21.   文章编辑器功能改进 &#10003;

22.   项目css布局抖动排查，优化网站首屏加载性能 &#10003;

23.   网站主页优化 &#10003;

第五次开会 2019/5/7

24.  建设网站点赞、收藏、打赏+奖励池体系 &#10003;

25.   使用 Hyperledger Fabric 存储文章信息、奖励池信息，版权纠纷信息 &#10003;

26.   引入redis做为首页、奖励池和公示页面的缓存服务器 x

27.   着手写毕业论文 !


## 到这个时间节点，毕设论坛的开发工作基本结束。接下来的半个月用在了写论文上面。另外考研也将会导致论坛开发的延后半年左右，这里做一个记录。

---------------------

#### 系统问题、漏洞以及bug

目前系统还存在许多漏洞和设计不完善的地方。

1. 框架问题

    整个网页目前都没有好好地进行过单元测试，这就不得不说到用到的antd这个框架了。

    开发过程中，用到的许多框架中其中比较让我不满意的就是 antd 这个 UI 框架了，这个框架的可定制性真的很低，而且学习成本蛮高的。另外运行的速度较慢和代码封装度高导致的定制性低是比较让我头疼的地方。用了他的素材库导致网页打包特别大，结果单元测试的时候覆盖率测不出来。。。我枯了。不过从美观性上来讲 antd 还蛮不错的(其实别的框架都能做得到的话，这反而不算优点了：D)。因此重构代码的工作会包含更换 UI 框架。

2. 项目打包

    react 这个框架挺好的，对于后期维护和重构来说都是一个不错的框架。不过目前论坛使用的是 create-react-app 脚手架做的打包，我不太喜欢这个打包方式，它隐藏了很多细节，下一步可能会把项目还原成 webpack 的打包方式。

3. 安全问题

    目前论坛的开发状况属于赶工状态，安全性其实无从谈起哈哈哈，所以我把账户密码和用户名的更改锁定了不能修改。接下来需要陆续从几个方面完善项目的安全性。

- 账户授权认证
- 账户白/黑名单
- 抵御 xss 攻击
- 抵御跨域攻击
- sql 注入抵御
- 等等

    具体细节我就不在这里细说了，会有单独的文档对这个部分具体分析。

4. 论坛 bug

    论坛现在的 bug 主要还是一些历史遗留问题。在开发过程中，由于是现学现卖，很多前端的操作，现在看来还蛮危险的233。这些 bug 的出现也说明代码的结构还不够良好，这一部分需要在后期进行进一步的完善与修复。具体会从以下几个方面对论坛现有 bug 进行调试：

- 单元测试
- 系统功能测试

    具体细节不便在这里细说，会有单独的文档对这个部分具体分析。

5. 编码风格

    论坛的编码风格还没有来得及统一，可能对于新的开发者来讲不够友好，这一方面在结束这个文档之后会尽可能地完善。

6. 区块链部分

    区块链部分的功能并没有被完善，主要原因还是涉及到区块链的功能大多属于管理和监控方面，具体开放给用户的功能是较少的——主要为了降低区块链的运行压力和负载（这个还是需要具体测试哈）。接下来区块链的工作会随着管理员界面的开发以及用户界面的功能完善逐步推进。

7. 跨平台问题

    论坛目前还是一个网页app，在移动端的开发暂时没有精力去实现。这方面可能需要有新的成员加入才会得到改善。至于使用什么样的技术，我希望还是开发原生的移动应用比较理想。论坛不会采用react native开发跨平台应用，主要还是考虑到react native虽然看上去简单，其实对于原生应用的支持不够完善。

    有希望一起来实现**梧桐林**移动端应用的朋友欢迎联系本人～
---------------------
# 论坛开发第二大阶段——准备部署第一个可用版本

#### 后续开发计划

新的 Scrum 过程会被启用！这里给出论坛的 Backlog v2.0 以便解释接下来的开发计划

ID|名字|重要性(Imp)|具体实现|注解|Sprint
-|-|-|-|-|-
1|论坛管理员界面|50|能够对论坛内容进行维护和管理|可以直接使用antd pro搞一个，这个界面没啥美观需求|1
2|论坛管理员API|50|用同样的web服务器实现相应的API| |1
3|前端代码重构和bug修复|50|主要是更换 UI 框架、代码解耦| |1
4|区块链服务完善|50|主要提供管理员的查询写入等功能| |2
5|论坛DevOps真正建立|40|为了提升部署的效率和版本迭代速度，结合现有工具实现DevOps是合适的| |2
6|全新的文章编辑功能|40|一个结合视频和文章为一体的界面良好的编辑器|最好能够做一次底层的尝试，加入语音识别的功能，文章能从视频中导出|3
7|论坛上传视频、图片|40|单独使用一个资源服务器来处理这件事|这部分需要一些学习和参考，视频上传会对网站造成巨量的资源要求，或许可以考虑引用别的网站视频|3
8|论坛“贴吧玩法”|40|构建一个全新的论坛玩法，可申请建立的板块模式，可投票选举的吧主等|板块可以参考百度贴吧的模式，并做一些适度创新|4
9|吧主界面|35|吧主可以有特殊的权限|具体情况会做一些落实|4
10|引入redis做论坛内容缓存|35|redis负责实时的排序运算、热门内容缓存等工作|这个工作是有必要完成的，它将大大延缓网站性能瓶颈的到来|5
11|ssr服务端渲染实现|30|ssr渲染将提升搜索引擎爬虫以及首页加载速度| |5

暂时把后续开发的计划描述到这里。这份需求表列出的是一些未来需要实现的重要任务。未来仍然使用Scrum过程来开发网站。
